:: Name:     CVE-2017-8529_RegFix.cmd
:: Purpose:  https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/cve-2017-8529
:: Info:     HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX - key does not exist 
:: contact:  alex.li@telus.com
:: Revision: May 02 2019

@ECHO OFF
SETLOCAL ENABLEEXTENSIONS ENABLEDELAYEDEXPANSION

:RegCheck-32
@echo *** FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX ***
@echo CVE-2017-8529 Post registry entry (32-bit) checking...
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Internet Explorer\Main\FeatureControl"|FINDSTR /R /C:"FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX"
IF %errorlevel%==0 (goto RegCheck-64) else (goto RegAdding-32)

:RegAdding-32
@echo 32-bit FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX registry value adding...
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX"  /v "iexplore.exe" /t REG_DWORD /d 1 /f

:RegCheck-64
@echo CVE-2017-8529 Post registry entry (64-bit) checking...
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Internet Explorer\Main\FeatureControl"|FINDSTR /R /C:"FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX"
IF %errorlevel%==0 (goto ValueCheck-32) else (goto RegAdding-64)

:RegAdding-64
@echo 64-bit FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX registry value adding...
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX"  /v "iexplore.exe" /t REG_DWORD /d 1 /f

:ValueCheck-32
@echo The 32 bit FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX registry value re-checking...
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX"|FINDSTR /R /C:"iexplore.exe"
IF %errorlevel%==0 (goto ValueCheck-64) else (goto setError)

:ValueCheck-64
@echo The 64 bit FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX registry value re-checking...
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX"|FINDSTR /R /C:"iexplore.exe"
IF %errorlevel%==0 (goto End) else (goto setError)

:setError
@echo The FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX Registry Value is NOT found on this server %computername%
@echo Please check... 
TIMEOUT /T 20
Endlocal
Exit /b 1

:End
@echo FEATURE_ENABLE_PRINT_INFO_DISCLOSURE_FIX is added or found.
@echo So later, %computername% will pass CVE-2017-8529 scanning...
TIMEOUT /T 20
Endlocal
Exit /b 0


